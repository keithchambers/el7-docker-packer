{
    "variables": {
        "version":      "YYYYMMDD",
        "source_image": "5b89941f-c8b5-4dcb-ade5-bec2fe4de893",
        "flavor":       "c33143d9-ce0a-472c-944b-3e39476970d3",
        "networks":     "2d84eaa4-8b81-4dc8-9897-dd8ef4719f8b"
    },
    "builders": [{
        "type":         "openstack",
        "image_name":   "CentOS-7-x86_64-Docker-{{user `version`}}",
        "source_image": "{{user `source_image`}}",
        "flavor":       "{{user `flavor`}}",
        "networks":     "{{user `networks`}}",
        "ssh_username": "centos"
    }],
    "provisioners": [{
        "type":         "shell",
        "inline": [     "sudo ln -sf /usr/share/zoneinfo/Etc/UTC /etc/localtime",
                        "sudo yum upgrade -y centos-release && sudo sed -i 's/enabled=0/enable=1/g' /etc/yum.repos.d/CentOS-fasttrack.repo",
                        "sudo yum install -y epel-release",
                        "sudo yum install -y http://cbs.centos.org/repos/virt7-testing/x86_64/os/Packages/docker-1.3.1-1.el7.centos.x86_64.rpm",
                        "sudo yum upgrade -y && sudo yum clean all",
                        "sudo reboot",
                        "sleep 30",
                        "sudo rm -f /etc/udev/rules.d/*-persistent-net.rules",
                        "sudo sed -i '/UUID/d' /etc/sysconfig/network-scripts/ifcfg-e* && sed -i '/HWADDR/d' /etc/sysconfig/network-scripts/ifcfg-e*",
                        "sudo cat /dev/null > /etc/resolv.conf && sudo cat /dev/null > /etc/hostname",
                        "sudo rm /root/.ssh/authorized_keys && sudo rm /home/centos/.ssh/authorized_keys",
                        "sudo rm -rf /tmp/* && sudo find /var/log -type f -delete",
                        "cat /dev/null > /home/centos/.bash_history && dd if=/dev/zero of=/ZERO bs=1M && rm -rf /ZERO && history -c && exit"]
    }]
}
